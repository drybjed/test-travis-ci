# iptables firewall managed by ferm

table filter {
	chain INPUT {
		mod comment comment "Generated by ferm - /etc/ferm/ferm.conf" NOP;
		policy DROP;

		# Connection tracking
		mod conntrack ctstate INVALID DROP;
		mod conntrack ctstate (ESTABLISHED RELATED) ACCEPT;

		# Allow local connections
		interface lo ACCEPT;

		# Drop connections from bad guys
		mod recent name "badguys" update seconds 3600 {
			mod limit limit 3/hour limit-burst 5 {
				LOG log-prefix "iptables-recent-badguys: " log-level warning;
			}
			DROP;
		}

		# Allow ICMP protocol
		protocol icmp ACCEPT;

		# Reject everything else
		protocol udp REJECT reject-with icmp-port-unreachable;
		protocol tcp REJECT reject-with tcp-reset;
		REJECT reject-with icmp-proto-unreachable;
	}

	chain OUTPUT {
		policy ACCEPT;

		# Connection tracking
		mod conntrack ctstate INVALID DROP;
		mod conntrack ctstate (ESTABLISHED RELATED) ACCEPT;
	}

	chain FORWARD {
		policy DROP;

		# Connection tracking
		mod conntrack ctstate INVALID DROP;
		mod conntrack ctstate (ESTABLISHED RELATED) ACCEPT;
	}
}

